{% extends "toolkit_controls_base.html" %}

{% load splunkmvc %}
{% load wftoolkit %}

{% block title %}Bubble Chart Examples{% endblock title %}

{% block css %}
{{block.super}}
<style type="text/css">
#bubble-chart1{
    height: 500px;
}
</style>
{% endblock css %}

{% block content %}
<div class="dashboard-body container-fluid main-section-body">
    <div class="row">
        <div class="span12 dashboard-header clearfix">
            <h2> {% block heading %}Bubble Chart Examples{% endblock heading %} </h2>
        </div>
    </div>
    <div class="dashboard-row">
        <div class="dashboard-cell" style="width: 100%;">
            <div class="dashboard-panel">
                <div class="dashboard-element">
                    <div class="panel-body">
                    <p>These use the search: <b>| inputlookup faa.demo.csv | stats count by OriginCityName OriginState | sort - count limit=30</b></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-row">
        
        <div class="dashboard-cell" style="width: 50%;">
            <div class="dashboard-panel">
                <div class="dashboard-element">
                    <div class="panel-head">
                        <h3>No Options</h3>
                    </div>
                    <div class="panel-body">
                        <div id="bubble-chart1"></div>
                        <div id="nameFieldSelect"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block managers %}

    {% searchmanager id="search1" search='| inputlookup musicdata.csv | search bc_uri=/sync/addtolibrary/* | stats count by artist_name, track_name' %}

    {% searchmanager id="search2" search='| inputlookup faa.demo.csv | stats count by OriginCityName OriginState | sort - count limit=30' %}
    {% searchmanager id="fieldSearch" search='| inputlookup faa.demo.csv | head 5000 | fieldsummary | where count>20' rf="*" %}

{% endblock managers %}

{% block js %}    

<script type="text/javascript">
    require([
        "splunkjs/ready!", 
        "splunkjs/mvc/utils",
        "underscore",
        "jquery",
        "wftoolkit/bubblechart",
        "splunkjs/mvc/dropdownview",
        "wftoolkit/sankeychart",
        ], 
        function(
            mvc, 
            utils,
            _, 
            $,
            BubbleChart,
            DropdownView,
            Sankey
        ){
            var bubbles = new BubbleChart({
                'id' : 'bubble-chart1',
                'managerid' : 'search2',
                'el' : $('#bubble-chart1')
            }).render();

            var dropdown = new DropdownView({
                            'id' : 'nameFieldSelect',
                            'valueField' : 'field',
                            'choices' : [
                                {label: "Origin City", value: "OriginCityName"},
                                {label: "Origin State", value: "OriginState"}
                            ],
                            'el' : $('#nameFieldSelect')
            }).render()

            dropdown.on("change", function(){
                bubbles.settings.set("nameField", dropdown.val());
            });
        });
</script>

{% endblock js %}
