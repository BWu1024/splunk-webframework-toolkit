{% extends "toolkit_controls_base.html" %}

{% load splunkmvc %}
{% load wftoolkit %}

{% block title %}{{app_name}} Custom View with Searchbar{% endblock title %}

{% block css %}
{{block.super}}
<style type="text/css">
.splunk-toolkit-sankey{
  height: 500px;
  margin: 10px;
  padding: 3px;
}
</style>
{% endblock css %}

  {% block heading %}Sankey Chart{% endblock heading %}
  {% block explanation %}The Sankey Chart visualizes flows between nodes.{% endblock explanation %}

  {% block example %}
    {% sankey id="sankey1" managerid="search" %}
  {% endblock example %}

{% block managers %}

{% searchmanager id="search" search='| inputlookup musicdata.csv | stats count by artist_name, eventtype | where (eventtype="ua-mobile-android" OR eventtype="ua-mobile-ipad" OR eventtype="ua-mobile-blackberry" OR eventtype="ua-mobile-iphone" OR eventtype="ua-mobile-ipod")' %}

{% endblock managers %}

{% block js %}    
<script>    
require(["splunkjs/ready!", "underscore"], function(mvc, _) {

        // Customize the sankey component.  As described in
        // sankeyfx.js, the formatName is an option that expects a
        // function.  That function takes a name from the search and
        // returns a formatted name.  In this case, replace access_log
        // strings for mobile clients with more readable names.
        mvc.Components.getInstance('sankey1').settings.set({
          'formatName': function(name) { 
            return {
              'ua-mobile-android': 'Android',
              'ua-mobile-ipad': 'iPad',
              'ua-mobile-blackberry': 'Blackberry',
              'ua-mobile-iphone': 'iPhone',
              'ua-mobile-ipod': 'iPod'
            }[name] || name;
          }
        });
    });
</script>
{% endblock js %}
